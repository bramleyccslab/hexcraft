# Compute the likelihood of current hypothesis
li_st<-  sum(log(c(c(1-pp$Au, pp$Au)[st$Au+1],
c(1-pp$Bu, pp$Bu)[st$Bu+1],
c(1-pp$Cu, pp$Cu)[st$Cu+1],
c(1-pp$Du, pp$Du)[st$Du+1],
c(1-pp$Eu, pp$Eu)[st$Eu+1],
c(1-pp$ABu, pp$ABu)[st$ABu+1],
c(1-pp$BCu, pp$BCu)[st$BCu+1],
c(1-pp$BDu, pp$BDu)[st$BDu+1],
c(1-pp$CEu, pp$CEu)[st$CEu+1],
c(1-pp$DEu, pp$DEu)[st$DEu+1])))
# And the new one... (this coudl be done more efficiently! You only NEED to evaluate the changed term)
li_st_prime<-  sum(log(c(c(1-pp$Au, pp$Au)[st_prime$Au+1],
c(1-pp$Bu, pp$Bu)[st_prime$Bu+1],
c(1-pp$Cu, pp$Cu)[st_prime$Cu+1],
c(1-pp$Du, pp$Du)[st_prime$Du+1],
c(1-pp$Eu, pp$Eu)[st_prime$Eu+1],
c(1-pp$ABu, pp$ABu)[st_prime$ABu+1],
c(1-pp$BCu, pp$BCu)[st_prime$BCu+1],
c(1-pp$BDu, pp$BDu)[st_prime$BDu+1],
c(1-pp$CEu, pp$CEu)[st_prime$CEu+1],
c(1-pp$DEu, pp$DEu)[st_prime$DEu+1])))
# Log likeliood ratio
ll_ratio<-li_st_prime - li_st
# Choose whether to accept
if (ll_ratio>=0)
{
if (verbose == T)
{
cat(ix, var, ll_ratio, 'better or same \n')
}
st<-st_prime
} else if (log(runif(1))<ll_ratio) {
cat(ix, var, ll_ratio, 'worse but accepted anyway \n')
st<-st_prime
} else {
cat(ix, var, ll_ratio, 'rejected \n')
}
st
}
# Counterfactual effect size is basically just the pearson correlation between the cause and the effect across the counterfactual sample
calculate_ces<-function(df, n)
{
ces<-list()
for (i in 1:(ncol(df)-1))
{
suppressWarnings( ces[names(df)[i]]<-cor(df[[names(df)[i]]][1:n], df$E[1:n]) )
}
unlist(ces)
}
#An example: Everything happened. What is the counterfactual effect size of of every variable
# Varying how long of a chain we look at to establish it from...?
# Let's run a long chain
n_samples<-10000
cf_samples<-prior_samples<-data.frame(Au=rep(NA, n_samples),
A=rep(NA, n_samples),
ABu=rep(NA, n_samples),
Bu=rep(NA, n_samples),
B=rep(NA, n_samples),
BCu=rep(NA, n_samples),
Cu=rep(NA, n_samples),
C=rep(NA, n_samples),
BDu=rep(NA, n_samples),
Du=rep(NA, n_samples),
D=rep(NA, n_samples),
CEu=rep(NA, n_samples),
DEu=rep(NA, n_samples),
Eu=rep(NA, n_samples),
E=rep(NA, n_samples))
cf_samples[1,]<-prior_samples[1,]<-unlist(initial_state)
# Loop along the chain generating the samples
for (step in 2:n_samples)
{
cf_samples[step,]<-resample_state(as.list(cf_samples[step-1,]), verbose = T)
# Also generate samples frmo the prior as a useful comparison set
prior_samples[step,]<-unlist(sample_state())
}
# Check that everything varies (isn't 1 or 0) which can happen if the parameters are too extreme
colMeans(cf_samples)
calculate_ces(cf_samples, n=100)
calculate_ces(cf_samples, n=1000)
calculate_ces(cf_samples, n=10000)
# Compare with sampling all your counterfactuals from your prior
calculate_ces(prior_samples, n=10000)
# Todo: Tadeg's model: with p=1-s resample states
head(cf_sample)
head(cf_samples)
head(cf_samples, 30)
calculate_ces(cf_samples, n=100)
calculate_ces(cf_samples, n=10000)
help(expand.grid)
expand.grid(list=(A=c(0,1),B=c(0,1),E=c(0,1)))
expand.grid(list(A=c(0,1),B=c(0,1),E=c(0,1)))
input_space<-expand.grid(list(A=c(0,1),B=c(0,1),C=c(0,1), D=c(0,1),E=c(0,1),F=c(0,1)))
rm(list=ls())
input_space<-expand.grid(list(A=c(0,1),B=c(0,1),C=c(0,1), D=c(0,1),E=c(0,1),F=c(0,1)))
input_space
2^64
input_space<-expand.grid(list(A=c(0,1),B=c(0,1),C=c(0,1)))
input_space
g<-matrix(0, 3,3)
g<-matrix(0, 4,4)
g[1,2]<-g[1,3]<-g[1,4]<-1
g
g<-matrix(0, 4,4)
g[1,4]<-g[2,4]<-g[3,4]<-1
g
g<-matrix(0, 4,4, dimnames=list(c('A','B','C','E'), c('A','B','C','E')))
g[1,4]<-g[2,4]<-g[3,4]<-1
g
input_space
input_space$E<-NA
input_space
rm(list=ls())
input_space<-expand.grid(list(A=c(0,1),B=c(0,1),C=c(0,1)))
strength<-.75
base_rate<-0.1
g<-matrix(0, 4,4, dimnames=list(c('A','B','C','E'), c('A','B','C','E')))
g[1,4]<-g[2,4]<-g[3,4]<-1
g
input_space$pE<-NA
input_space
library(tidyverse)
input_space<- input_space %>% mutate(pE = 1-(1-base_rate)*(1-strength)^A*(1-strength)^B*(1-strength)^C)
input_space
data<-data.frame(A=c(1,1,1,0,0,0), B=c(1,0,0,0,0,0), C=c(1,1,1,1,0,0),E=c(1,0,1,0,1,0))
data
g
g2<-g
g2[3,4]<-0
g2
g2
input_space
strength_samples<-runif(1000)
baserate_samples<-runif(1000)
stregnth_samples
strength_samples
input_space
input_space<- input_space %>% mutate(pE = 1-(1-base_rate)*(1-strength)^A*(1-strength)^B*(strength)^C)
input_space
input_space<- input_space %>% mutate(pE = (1-(1-base_rate)*(1-strength)^A*(1-strength)^B)*(strength)^C)
input_space
data
prior<-c(1,1,1)/3
prior
prior<-c(g1:1,1,1)/3
prior
prior<-c('g1'=1,1,1)/3
prior
prior<-c('g1'=1,'g2'=1,'g3'=1)/3
prior<-c('g1'=1,'g2'=1,'g3'=1)/3
prior
data
posterior_unnormalised<- prior * likelihood
posterior
posterior_unnormalised
posterior_unnormalised<- prior * likelihood
posterior_unnormalised
posterior_unnormalised
likelihood<-c(.0000001, .0000002, .00000015)
posterior_unnormalised<- prior * likelihood
posterior_unnormalised
posterior<-posterior_unnormalised/sum(posterior_unnormalised)
posterior
exp(-2000)
exp(-200)
sum(posterior)
12+2+7+58+4+24+10+6+4+4+4+18+10+8+18+3+23
2^16
rm(list=ls())
likelihoods<-list(P= c(.9,.1),
H_P=c(.5,.5),
H_notP=c(.99, .01),
V_PH=c(.01, .99),
V_PnotH=c(.99,.01),
V_notPH=c(.01,.99),
V_notPnotH=c(.999,.001),
D1_P=c(.3,.7),
D1_notP=c(.7,.3),
D2_P=c(.3,.7),
D2_notP=c(.7,.3),
D4_V=c(.99,.01),
D4_notV=c(.7,.3),
D5_V=c(.99,.01),
D5_notV=c(.7,.3),
D6_V=c(.5,.5),
D6_notV=c(.99,.01))
sapply(likelihoods, sum)
1098.34	+1089.11+1087.64+1025.97
0.98+0.84+1.83+2.31+0.33+0.21
0.98+0.84+1.83+2.31+0.33+0.21 + 8.55+5.77+8.49+9.49+10.26+11.18+10.55+11.64+7.67+6.26
prior<-c(.75,.25)
likelihood<-c(20,1)
prior*likelihood
prior*likelihood/sum(prior*likelihood)
likelihood<-c(1,1/20)
prior*likelihood/sum(prior*likelihood)
4*1.4
400/5.6
matrix(c(round(rnorm(100)*100)), 10,10)
matrix(c(round(rnorm(100)*100))+100, 10,10)
matrix(c(round(rnorm(100)*100))+200, 10,10)
matrix(c(round(rnorm(100)*100))+500, 10,10)
chisq.test(matrix(c(round(rnorm(100)*100))+500, 10,10))
342071*2.01
(342071*2.01)/3
c(111449,114494,114134,119904)*2
594/2
setwd("~/Documents/GitHub/hexcraft/R/exp2")
rm(list=ls())
load('../dat/exp2.rdata')
View(df.sw)
View(df.sw)
df.sw %>% select(prolific_id, bonus)
library(tidyverse)
df.sw %>% select(prolific_id, bonus)
setwd("~/Documents/GitHub/hexcraft/R/exp2")
library(RMySQL)
library(rjson)
library(tidyverse)
rm(list=ls())
#ssh -L 1111:127.0.0.1:3306 nbramley@eco.ppls.ed.ac.uk
# Password:your_eco_password
mydb = dbConnect(RMySQL::MySQL(),
user='eco_mdb_root',
password='KZrQupBmNL',
dbname='eco_mdb1',
host='127.0.0.1',
port=1111,
table='hexcraft_exp2')
dbListTables(mydb)
df.raw<-dbReadTable(mydb,"hexcraft_exp2")
df.raw<-df.raw[c(12:21),]
df.raw<-dbReadTable(mydb,"hexcraft_exp2")
vec<-rep(NA, nrow(df.raw))
vecF<-rep(F, nrow(df.raw))
vec0<-rep(0, nrow(df.raw))
df.sw<-data.frame(p_ix=vec,
prolific_id=vec,
condition=vec,
gender=vec,
age=vec,
ins_time=vec,tut_time=vec,trial_time=vec,total_time=vec,
comprehension_score=vec, tutorial_tries=vec, tutorial_keys = vec,
c1t1=vecF,c1t2=vecF,c1t3=vecF,
c2t1=vecF,c2t2=vecF,c2t3=vecF,
test1=vec,test2=vec,test3=vec,test4=vec,test5=vec,
c1t1_tries=vec0,c1t2_tries=vec0,c1t3_tries=vec0,
c2t1_tries=vec0,c2t2_tries=vec0,c2t3_tries=vec0,
test1_tries=vec, test2_tries=vec,test3_tries=vec,test4_tries=vec,test5_tries=vec,
total=vec,
m_steps=vec,m_steps_successes=vec, m_steps_failures=vec,
n_add=vec,n_delete=vec,n_corner=vec,n_bar=vec,n_move=vec,n_rotate=vec,n_flip=vec,n_reflect=vec,
comments=vec)
df.tw<-data.frame(p_ix=c(),
prolific_id=c(),
condition=c(),
trial=c(),
attempt=c(),
actions=c(),
success=c())
ls.states<-list()
for (ppt in 1:nrow(df.raw))
{
ls.p<-fromJSON(df.raw$results[[ppt]])
df.sw$p_ix[ppt]<-ppt
df.sw$prolific_id[ppt]<-ls.p$subjectwise$prolific_id
df.sw$condition[ppt]<-ls.p$subjectwise$condition
df.sw$gender[ppt]<-ls.p$subjectwise$gender
df.sw$age[ppt]<-ls.p$subjectwise$age
df.sw$ins_time[ppt]<-round((ls.p$subjectwise$timings$tutorial-ls.p$subjectwise$timings$start)/(1000*60), digits = 2)
df.sw$tut_time[ppt]<-round((ls.p$subjectwise$timings$test-ls.p$subjectwise$timings$tutorial)/(1000*60), digits = 2)
df.sw$trial_time[ppt]<-round((ls.p$subjectwise$timings$end-ls.p$subjectwise$timings$test)/(1000*60), digits = 2)
df.sw$total_time[ppt]<-round((ls.p$subjectwise$timings$end-ls.p$subjectwise$timings$start)/(1000*60), digits = 2)
df.sw$comprehension_score[ppt]<-sum(ls.p$subjectwise$comprehension)
for (trial in 1:8)
{
if (trial<4)
{
df.sw[[paste0('c', ls.p$subjectwise$condition+1, 't',trial ,sep='')]][ppt]<-any(sapply(ls.p$trials[[trial]], '[[', 'result'))
df.sw[[paste0('c', ls.p$subjectwise$condition+1, 't',trial,'_tries',sep='')]][ppt]<-length(ls.p$trials[[trial]])
} else {
df.sw[[paste0('test',trial-3 ,sep='')]][ppt]<-any(sapply(ls.p$trials[[trial]], '[[', 'result'))
df.sw[[paste0('test',trial-3,'_tries',sep='')]][ppt]<-length(ls.p$trials[[trial]])
}
for (attempt in 1:length(ls.p$trials[[trial]]))
{
success<-F
if (!is.null(ls.p$trials[[trial]][[attempt]]$result))
{
success<-ls.p$trials[[trial]][[attempt]]$result
}
df.tw<-rbind(df.tw,
data.frame(p_ix=ppt,
prolific_id=ls.p$subjectwise$prolific_id,
condition=ls.p$subjectwise$condition,
trial=trial,
attempt=attempt,
actions=paste0(ls.p$trials[[trial]][[attempt]]$actions, collapse=','),
keycodes=paste0(sapply(ls.p$trials[[trial]][[attempt]]$keys, '[[', 'key'), collapse=''),
success=success))
}
}
df.sw$comments[ppt]<-ls.p$subjectwise$comments
df.sw$n_add[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'A')
df.sw$n_delete[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'D')
df.sw$n_corner[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'Z')
df.sw$n_bar[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'X')
df.sw$n_move[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'W')+
str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'E')+
str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'S')
df.sw$n_rotate[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'R')
df.sw$n_flip[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'F')
df.sw$n_reflect[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'K')
df.sw$m_steps[ppt]<-mean(nchar(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]])))
df.sw$m_steps_successes[ppt]<-mean(nchar(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]]))[df.tw$success[df.tw$p_ix==df.sw$p_ix[ppt]]])
df.sw$m_steps_failures[ppt]<-mean(nchar(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]]))[!df.tw$success[df.tw$p_ix==df.sw$p_ix[ppt]]])
# And let's extract the larger and less important items:
ls.states[[ppt]]<-list()
for (trial in 1:length(ls.p$state_history_tests))
{
ls.states[[ppt]][[trial]]<-list()
for (attempt in 1:length(ls.p$state_history_tests[[trial]]))
{
ls.states[[ppt]][[trial]][[attempt]]<-list()
for (step in 1:length(ls.p$state_history_tests[[trial]][[attempt]]))
{
ls.states[[ppt]][[trial]][[attempt]][[step]]<-matrix(unlist(ls.p$state_history_tests[[trial]][[attempt]][[step]]), ncol=9)
}
}
}
this_ppt_tutorial_tries<-this_ppt_tutorial_keys<-rep(NA, length(ls.p$tutorials))
for (tutorial in 1:length(ls.p$tutorials))
{
this_ppt_tutorial_tries[tutorial]<-length(ls.p$tutorials[[tutorial]])
this_ppt_tutorial_keys[tutorial]<-''
for (attempt in 1:length(ls.p$tutorials[[tutorial]]))
{
this_ppt_tutorial_keys[tutorial]<-paste0(this_ppt_tutorial_keys[tutorial], paste0(sapply(ls.p$tutorials[[tutorial]][[attempt]]$keys, '[[', 'key'), collapse=''))
}
}
df.sw$tutorial_tries[ppt]<-paste0(this_ppt_tutorial_tries, collapse=',')
df.sw$tutorial_keys[ppt]<-paste0(nchar(this_ppt_tutorial_keys), collapse=',')
}
rm(list=ls())
#ssh -L 1111:127.0.0.1:3306 nbramley@eco.ppls.ed.ac.uk
# Password:your_eco_password
mydb = dbConnect(RMySQL::MySQL(),
user='eco_mdb_root',
password='KZrQupBmNL',
dbname='eco_mdb1',
host='127.0.0.1',
port=1111,
table='hexcraft_exp2')
dbListTables(mydb)
df.raw<-dbReadTable(mydb,"hexcraft_exp2")
df.raw<-df.raw[c(12:21),]
vec<-rep(NA, nrow(df.raw))
vecF<-rep(F, nrow(df.raw))
vec0<-rep(0, nrow(df.raw))
df.sw<-data.frame(p_ix=vec,
prolific_id=vec,
condition=vec,
gender=vec,
age=vec,
ins_time=vec,tut_time=vec,trial_time=vec,total_time=vec,
comprehension_score=vec, tutorial_tries=vec, tutorial_keys = vec,
c1t1=vecF,c1t2=vecF,c1t3=vecF,
c2t1=vecF,c2t2=vecF,c2t3=vecF,
test1=vec,test2=vec,test3=vec,test4=vec,test5=vec,
c1t1_tries=vec0,c1t2_tries=vec0,c1t3_tries=vec0,
c2t1_tries=vec0,c2t2_tries=vec0,c2t3_tries=vec0,
test1_tries=vec, test2_tries=vec,test3_tries=vec,test4_tries=vec,test5_tries=vec,
total=vec,
m_steps=vec,m_steps_successes=vec, m_steps_failures=vec,
n_add=vec,n_delete=vec,n_corner=vec,n_bar=vec,n_move=vec,n_rotate=vec,n_flip=vec,n_reflect=vec,
comments=vec)
df.tw<-data.frame(p_ix=c(),
prolific_id=c(),
condition=c(),
trial=c(),
attempt=c(),
actions=c(),
success=c())
ls.states<-list()
for (ppt in 1:nrow(df.raw))
{
ls.p<-fromJSON(df.raw$results[[ppt]])
df.sw$p_ix[ppt]<-ppt
df.sw$prolific_id[ppt]<-ls.p$subjectwise$prolific_id
df.sw$condition[ppt]<-ls.p$subjectwise$condition
df.sw$gender[ppt]<-ls.p$subjectwise$gender
df.sw$age[ppt]<-ls.p$subjectwise$age
df.sw$ins_time[ppt]<-round((ls.p$subjectwise$timings$tutorial-ls.p$subjectwise$timings$start)/(1000*60), digits = 2)
df.sw$tut_time[ppt]<-round((ls.p$subjectwise$timings$test-ls.p$subjectwise$timings$tutorial)/(1000*60), digits = 2)
df.sw$trial_time[ppt]<-round((ls.p$subjectwise$timings$end-ls.p$subjectwise$timings$test)/(1000*60), digits = 2)
df.sw$total_time[ppt]<-round((ls.p$subjectwise$timings$end-ls.p$subjectwise$timings$start)/(1000*60), digits = 2)
df.sw$comprehension_score[ppt]<-sum(ls.p$subjectwise$comprehension)
for (trial in 1:8)
{
if (trial<4)
{
df.sw[[paste0('c', ls.p$subjectwise$condition+1, 't',trial ,sep='')]][ppt]<-any(sapply(ls.p$trials[[trial]], '[[', 'result'))
df.sw[[paste0('c', ls.p$subjectwise$condition+1, 't',trial,'_tries',sep='')]][ppt]<-length(ls.p$trials[[trial]])
} else {
df.sw[[paste0('test',trial-3 ,sep='')]][ppt]<-any(sapply(ls.p$trials[[trial]], '[[', 'result'))
df.sw[[paste0('test',trial-3,'_tries',sep='')]][ppt]<-length(ls.p$trials[[trial]])
}
for (attempt in 1:length(ls.p$trials[[trial]]))
{
success<-F
if (!is.null(ls.p$trials[[trial]][[attempt]]$result))
{
success<-ls.p$trials[[trial]][[attempt]]$result
}
df.tw<-rbind(df.tw,
data.frame(p_ix=ppt,
prolific_id=ls.p$subjectwise$prolific_id,
condition=ls.p$subjectwise$condition,
trial=trial,
attempt=attempt,
actions=paste0(ls.p$trials[[trial]][[attempt]]$actions, collapse=','),
keycodes=paste0(sapply(ls.p$trials[[trial]][[attempt]]$keys, '[[', 'key'), collapse=''),
success=success))
}
}
df.sw$comments[ppt]<-ls.p$subjectwise$comments
df.sw$n_add[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'A')
df.sw$n_delete[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'D')
df.sw$n_corner[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'Z')
df.sw$n_bar[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'X')
df.sw$n_move[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'W')+
str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'E')+
str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'S')
df.sw$n_rotate[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'R')
df.sw$n_flip[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'F')
df.sw$n_reflect[ppt]<-str_count(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]], collapse=''),'K')
df.sw$m_steps[ppt]<-mean(nchar(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]])))
df.sw$m_steps_successes[ppt]<-mean(nchar(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]]))[df.tw$success[df.tw$p_ix==df.sw$p_ix[ppt]]])
df.sw$m_steps_failures[ppt]<-mean(nchar(paste0(df.tw$keycodes[df.tw$p_ix==df.sw$p_ix[ppt]]))[!df.tw$success[df.tw$p_ix==df.sw$p_ix[ppt]]])
# And let's extract the larger and less important items:
ls.states[[ppt]]<-list()
for (trial in 1:length(ls.p$state_history_tests))
{
ls.states[[ppt]][[trial]]<-list()
for (attempt in 1:length(ls.p$state_history_tests[[trial]]))
{
ls.states[[ppt]][[trial]][[attempt]]<-list()
for (step in 1:length(ls.p$state_history_tests[[trial]][[attempt]]))
{
ls.states[[ppt]][[trial]][[attempt]][[step]]<-matrix(unlist(ls.p$state_history_tests[[trial]][[attempt]][[step]]), ncol=9)
}
}
}
this_ppt_tutorial_tries<-this_ppt_tutorial_keys<-rep(NA, length(ls.p$tutorials))
for (tutorial in 1:length(ls.p$tutorials))
{
this_ppt_tutorial_tries[tutorial]<-length(ls.p$tutorials[[tutorial]])
this_ppt_tutorial_keys[tutorial]<-''
for (attempt in 1:length(ls.p$tutorials[[tutorial]]))
{
this_ppt_tutorial_keys[tutorial]<-paste0(this_ppt_tutorial_keys[tutorial], paste0(sapply(ls.p$tutorials[[tutorial]][[attempt]]$keys, '[[', 'key'), collapse=''))
}
}
df.sw$tutorial_tries[ppt]<-paste0(this_ppt_tutorial_tries, collapse=',')
df.sw$tutorial_keys[ppt]<-paste0(nchar(this_ppt_tutorial_keys), collapse=',')
}
df.sw<- df.sw %>% mutate(total = c1t1+c1t2+c1t3+c2t1+c2t2+c2t3+test1+test2+test3+test4+test5,
bonus = total*0.2,
condition = factor(condition, levels = 0:1, labels = c('train_reflect','train_flower')))
# training group 1:
#   A WWR∠R∠R
# AWA WWR∠R∠R
# AWAWA WWR∠R∠R
# training group 2:
#   XR∠RD
# XR∠RD SSW
# XR∠R∠D ESES
# tests:
#   Z∠∠ WWR∠R∠R
# Z∠∠D WWR∠R∠R
# XR∠RD WR
# XR∠RD EES R∠R
# XR∠RD WWR∠R∠R
df.tw<-df.tw %>% mutate(condition = factor(condition, levels = 0:1, labels = c('train1_reflect','train2_flower')))
df.tw$trial
# A clunky way to get the trial type in the right order for condition 2
df.tw$trial_type<-df.tw$trial
ix4<-which(df.tw$condition=='train2_flower' & df.tw$trial==4)
ix5<-which(df.tw$condition=='train2_flower' & df.tw$trial==5)
ix6<-which(df.tw$condition=='train2_flower' & df.tw$trial==6)
ix7<-which(df.tw$condition=='train2_flower' & df.tw$trial==7)
df.tw$trial_type[ix4]<-6
df.tw$trial_type[ix5]<-7
df.tw$trial_type[ix6]<-4
df.tw$trial_type[ix7]<-5
df.tw<-df.tw %>% mutate(trial_type = case_match(trial, 1~'train_rr1',2~'train_rr2',3~'train_rr3',
4~'test_rr1',5~'test_rr2',6~'test_f1',7~'test_f2',8~'test_both'),
trial_solution = case_match(trial, 1~'AWWRKRKR',2~'AWAWWRKRKR',3~'AWAWAWWRKRKR',
4~'ZKKWWRKRKR',5~'ZKKDWWRKRKR',6~'ZXDRWR',7~'ZXDREESRKR',8~'ZXDRWWRKRKR'),
train_test = factor(trial<4, levels = c(T,F), labels = c('train','test')))
df.tw$trial_solution[df.tw$condition=='train2_flower' & df.tw$trial==1]<-'ZXDR'
df.tw$trial_solution[df.tw$condition=='train2_flower' & df.tw$trial==2]<-'ZXDRWWE'
df.tw$trial_solution[df.tw$condition=='train2_flower' & df.tw$trial==3]<-'ZXDRWWF'
df.tw$trial_type[df.tw$condition=='train2_flower' & df.tw$trial==1]<-'ZXDR'
df.tw$trial_type[df.tw$condition=='train2_flower' & df.tw$trial==2]<-'ZXDRWWE'
df.tw$trial_type[df.tw$condition=='train2_flower' & df.tw$trial==3]<-'ZXDRWWF'
df.sw
df.tw
df.sw$prolific_id
save(file='../dat/exp2.rdata', df.sw, df.tw)
df.sw %>% select(prolific_id, bonus)
